pipeline {
          environment {
		DOCKER_IMAGE = 'debian:latest'
		}
//agent {  docker { image 'debian:latest' }	}
//

stages {
//Начинаем шаги //	
stage ('build dockerfile') {
	agent { dockerfile true }
}
stage('Установка Kube ctl') {	
   agent {
      kubernetes {
         yaml '''
            apiVersion: v1
            kind: Deployment
            spec:
              replicas: 2
            spec:
             containers:
             - name: debian
            image: debian:latest
            '''
       }
    }
//
}
stage('Deployment') {
 steps{
	sh './kubectl create -f deployment.yaml -n lesson-4 --validate=false'
	}
}	
		//--||    ||--//
stage('Сетевые настройки ') {
	  steps {
	  sh 'ip a'
	  }
}
stage('Какая ОС ') {
	 steps {
	  sh 'uname -a'	  
	  }
	}  	
}
//
    post {
        always {
            echo 'The jenkins-build repository run is finished.'
        }
        changed {
            echo 'There is a different result than the last run.'
        }
        fixed {
            echo 'This run fixed problems from the previous one.'
        }
        regression {
            echo 'This run had regressions from the previous run.'
        }
        aborted {
            echo 'This run was aborted.'
        }
        failure {
            echo 'This run failed.'
        }
        success {
            echo 'This run succeeded.'
        }
    }
}